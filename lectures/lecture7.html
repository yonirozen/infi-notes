<!-- filename: infi2_lesson7.html -->
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>אינפי 2 - שיעור 7</title>

    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Shared Dark Mode CSS -->
    <link rel="stylesheet" href="../styles/dark-mode.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #0a5a8d; /* Deeper Blue */
            --secondary-color: #495057; /* Dark Gray */
            --accent-color: #f0ad4e; /* Orange/Yellow Accent */
            --highlight-color: #fdebd0; /* Softer Highlight */
            --bg-color: #fdfcfb; /* Off-white / Creamy */
            --text-color: #343a40; /* Darker Text */
            --border-color: #ced4da;
            --font-family-hebrew: 'Assistant', 'Rubik', sans-serif;
            --font-family-heading: 'Orbitron', 'Assistant', sans-serif;
            --card-bg: #ffffff;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
            --card-hover-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
            --border-radius: 12px; /* More rounded */
            --header-bg: linear-gradient(135deg, var(--primary-color), #007bb5);
            --header-text: #ffffff;
            --nav-bg: rgba(255, 255, 255, 0.9);
            --nav-text: var(--primary-color);
            --nav-hover-bg: var(--primary-color);
            --nav-hover-text: #ffffff;
            --section-border: var(--primary-color);
            --section-hover-border: var(--accent-color);
            --formula-bg: #f8f9fa;
            --formula-border: #e9ecef;
            --definition-bg: #fffaf0;
            --definition-border: var(--accent-color);
            --definition-heading: var(--accent-color);
            --example-bg: #f8f9fa;
            --example-border: var(--secondary-color);
            --katex-inline-color: var(--primary-color);
            --katex-display-color: var(--text-color);
            --body-pattern: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23e9ecef" fill-opacity="0.4"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            --transition-speed: 0.4s;
            --chart-axis-color: #333333; /* Default dark axis for better visibility on light bg*/
            --chart-grid-color: rgba(128, 128, 128, 0.2);
            --chart-fill-color: rgba(10, 90, 141, 0.2); /* Semi-transparent fill based on primary */
            --placeholder-bg: #eee;
            --placeholder-border: #ccc;
            --placeholder-text: #888;
        }

        /* --- Dark Mode Variables --- */
        html[data-theme="dark"] {
            --primary-color: #58a6ff; /* Lighter Blue */
            --secondary-color: #8b949e; /* Lighter Gray */
            --accent-color: #f7b731; /* Brighter Yellow */
            --highlight-color: #2d333b; /* Darker Highlight */
            --bg-color: #0d1117; /* Very Dark Gray/Black */
            --text-color: #c9d1d9; /* Light Gray Text */
            --border-color: #30363d;
            --card-bg: #161b22; /* Dark Card Background */
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
            --card-hover-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            --header-bg: linear-gradient(135deg, #1f6feb, #21262d);
            --header-text: #e6edf3;
            --nav-bg: rgba(22, 27, 34, 0.85); /* Darker Nav */
            --nav-text: var(--primary-color);
            --nav-hover-bg: var(--primary-color);
            --nav-hover-text: #0d1117;
            --section-border: var(--primary-color);
            --section-hover-border: var(--accent-color);
            --formula-bg: #1c2128; /* Darker Formula Block */
            --formula-border: #30363d;
            --definition-bg: #20242a; /* Darker Definition */
            --definition-border: var(--accent-color);
            --definition-heading: var(--accent-color);
            --example-bg: #1c2128; /* Darker Example Block */
            --example-border: var(--secondary-color);
            --katex-inline-color: #79c0ff; /* Lighter Blue for Inline Katex */
            --katex-display-color: var(--text-color);
            --body-pattern: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%2330363d" fill-opacity="0.4"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            --chart-axis-color: #c9d1d9; /* Dark axis (light gray text) */
            --chart-grid-color: rgba(128, 128, 128, 0.2); /* Grid can stay the same or be slightly adjusted */
            --chart-fill-color: rgba(88, 166, 255, 0.2); /* Semi-transparent fill based on primary */
             --placeholder-bg: #2a3038;
            --placeholder-border: #444c56;
            --placeholder-text: #768390;
        }


        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
             transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease, border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease; /* Added transition for smooth theme change */
        }

        html {
            scroll-behavior: smooth;
            font-size: 100%; /* Base 16px */
        }

        body {
            font-family: var(--font-family-hebrew);
            line-height: 1.8;
            color: var(--text-color);
            background-color: var(--bg-color);
            background-image: var(--body-pattern);
            font-weight: 300; /* Lighter default weight */
        }

        .container {
            max-width: 900px; /* Adjusted max-width for better readability */
            margin: 30px auto;
            padding: 0 25px;
        }

        header {
            background: var(--header-bg);
            color: var(--header-text);
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 40px;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: 0 4px 10px rgba(0, 86, 179, 0.3);
            clip-path: polygon(0 0, 100% 0, 100% 90%, 50% 100%, 0 90%); /* Stylish shape */
            animation: fadeInDown 1s ease-out 0.2s backwards;
            position: relative; /* For credits positioning */
        }
         html[data-theme="dark"] header {
             box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
         }

            header h1 {
                font-family: var(--font-family-heading);
                font-size: 2.8em; /* Adjusted title size */
                font-weight: 700;
                letter-spacing: 1px;
                text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
                margin-bottom: 10px; /* Space for credits */
            }
             .credits {
                font-size: 0.9em;
                font-weight: 300;
                opacity: 0.8;
                margin-top: 15px; /* Position below the clipped path */
                color: var(--header-text);
            }

        nav {
            background-color: var(--nav-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); /* For Safari */
            padding: 10px 15px; /* Adjusted padding */
            border-radius: var(--border-radius);
            margin-bottom: 40px;
            box-shadow: var(--card-shadow);
            position: sticky;
            top: 15px;
            z-index: 1000;
            transition: top 0.3s ease, background-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            border: 1px solid rgba(0,0,0,0.05);
             /* Removed overflow: hidden; to allow internal scrolling */
        }
         html[data-theme="dark"] nav {
              border: 1px solid var(--border-color);
         }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: nowrap; /* Prevent wrapping */
            justify-content: flex-start; /* Align items to the start */
            gap: 10px 15px; /* Row and column gap */
            padding-bottom: 10px; /* Space for scrollbar */
            overflow-x: auto; /* Enable horizontal scroll */
            white-space: nowrap; /* Keep items on one line */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            margin-bottom: -10px; /* Counteract padding-bottom for visual alignment */
            scroll-behavior: smooth; /* Smooth scrolling for programmatic scroll */
        }

        /* Hide scrollbar visually but keep functionality */
        nav ul::-webkit-scrollbar { height: 6px; background-color: transparent;}
        nav ul::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.2); border-radius: 3px; }
        html[data-theme="dark"] nav ul::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.2); }
        nav ul { -ms-overflow-style: none; scrollbar-width: thin; scrollbar-color: rgba(0,0,0,0.2) transparent;} /* Firefox */
         html[data-theme="dark"] nav ul { scrollbar-color: rgba(255,255,255,0.2) transparent; }


        nav ul li {
            flex-shrink: 0; /* Prevent items from shrinking */
        }

        nav ul li a {
            text-decoration: none;
            color: var(--nav-text);
            font-weight: 500; /* Medium weight */
            padding: 8px 12px; /* Adjusted padding */
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: inline-block; /* Needed for transform */
            border: 1px solid transparent;
             white-space: normal; /* Allow text wrapping within the link if needed */
             text-align: center;
             direction: rtl; /* Ensure Hebrew text aligns correctly */
        }

        /* Style for the math span inside the link - force LTR */
        nav ul li a span.math {
            direction: ltr !important;
            unicode-bidi: embed !important;
            display: inline-block; /* Or inline */
            vertical-align: middle;
            color: inherit; /* Inherit color from link */
            font-size: 0.95em; /* Slightly smaller than link text */
            margin: 0 2px; /* Small spacing */
            padding: 0;
        }
        /* Style for the math span on hover/active states */
        nav ul li a:hover span.math,
        nav ul li a.active span.math {
            color: inherit; /* Ensure it matches link text color */
        }


        nav ul li a:hover, nav ul li a.active {
            background-color: var(--nav-hover-bg);
            color: var(--nav-hover-text);
            transform: translateY(-2px) scale(1.02); /* Subtle lift */
            box-shadow: 0 3px 6px rgba(0, 86, 179, 0.15);
            border-color: transparent;
        }
        html[data-theme="dark"] nav ul li a:hover, html[data-theme="dark"] nav ul li a.active {
            box-shadow: 0 3px 6px rgba(88, 166, 255, 0.2);
        }
        nav ul li a.active {
            font-weight: 700;
        }


        main section {
            background-color: var(--card-bg);
            padding: 30px 35px; /* More padding */
            margin-bottom: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border-right: 7px solid var(--section-border); /* Changed border side for RTL */
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.5s ease, transform 0.5s ease; /* Added opacity/transform */
            opacity: 0; /* Start hidden for animation */
            transform: translateY(20px); /* Start slightly lower */
            overflow: hidden; /* Contain elements */
        }

         main section.visible {
            opacity: 1;
            transform: translateY(0);
         }

            main section:hover {
                box-shadow: var(--card-hover-shadow);
                transform: translateY(-8px) scale(1.01); /* Slightly larger lift and subtle scale */
                border-right-color: var(--section-hover-border); /* Change border on hover */
            }

        main h2 {
            font-family: var(--font-family-heading);
            font-size: 2.0em; /* Adjusted section titles */
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--border-color); /* Use variable */
            letter-spacing: 0.5px;
            font-weight: 700;
        }

        main h3 {
            font-family: var(--font-family-hebrew); /* Ensure consistent font */
            font-size: 1.5em; /* Adjusted sub-section titles */
            color: var(--secondary-color);
            margin-top: 30px;
            margin-bottom: 20px;
            font-weight: 600; /* Bold */
             border-bottom: 1px dashed var(--border-color);
             padding-bottom: 8px;
             width: fit-content;
        }

        main h4 {
            font-size: 1.2em; /* Adjusted slightly */
            font-weight: 600;
            margin-top: 25px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        p, li {
            margin-bottom: 1em;
             color: var(--text-color);
             font-weight: 400; /* Regular weight for readability */
             font-size: 1.05em;
        }

        ul, ol {
            padding-right: 25px; /* Indentation for RTL lists */
            margin-bottom: 1em; /* Spacing below lists */
        }
         li { margin-bottom: 0.5em; } /* Smaller space between list items */
         li::marker { /* Style list markers */
            color: var(--primary-color);
            font-weight: 600;
         }

        .formula-block {
            background-color: var(--formula-bg);
            padding: 15px 20px; /* Adjusted padding */
            margin: 25px auto; /* Center block */
            border-radius: 8px;
            overflow-x: auto; /* Handle long formulas */
            text-align: center;
            border: 1px solid var(--formula-border);
            max-width: 100%;
            transition: box-shadow var(--transition-speed) ease, background-color var(--transition-speed) ease, border-color var(--transition-speed) ease;
             position: relative; /* For potential ::before/::after */
        }
        .formula-block:hover {
            box-shadow: 0 2px 5px rgba(0,0,0,0.07);
        }
         html[data-theme="dark"] .formula-block:hover {
             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
         }

            /* Force LTR for math layout & prevent clipping */
            .formula-block div.math { /* UPDATED SELECTOR */
                margin: 0 auto; /* Center math block */
                direction: ltr !important; /* CRITICAL FOR RTL ISSUE */
                unicode-bidi: embed !important; /* CRITICAL FOR RTL ISSUE */
                text-align: center; /* Center content within LTR block */
                padding: 10px 5px; /* ADDED PADDING to prevent clipping */
                overflow-x: auto; /* Scroll long equations */
                overflow-y: hidden;
                display: block; /* Make sure it behaves as a block */
                 color: var(--katex-display-color); /* Use variable */
                 max-width: 100%; /* Ensure it doesn't overflow parent */
                 font-size: 1.1em; /* Slightly larger display math */
            }

        /* Style KaTeX inline math */
        span.math { /* UPDATED SELECTOR */
            font-size: 1.1em; /* Adjusted inline math size */
            color: var(--katex-inline-color); /* Use variable */
             direction: ltr !important; /* Inline math also LTR */
             unicode-bidi: embed !important;
             padding: 0 3px; /* Inline padding */
             vertical-align: middle; /* Better alignment with text */
             transition: color var(--transition-speed) ease; /* Smooth color change */
             font-weight: 500; /* Slightly bolder */
        }

        .definition {
            border-right: 5px solid var(--definition-border); /* Use accent color, RTL */
            border-left: none; /* Remove left border */
            padding: 20px 25px 15px 25px; /* Adjusted padding */
            margin: 25px 0;
            background-color: var(--definition-bg); /* Very light yellow/cream */
            border-radius: 8px;
             box-shadow: 0 2px 4px rgba(0,0,0,0.05);
             transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
         html[data-theme="dark"] .definition {
             box-shadow: 0 2px 6px rgba(0,0,0,0.2);
         }
            .definition h4 {
                 color: var(--definition-heading); /* Match border */
                 margin-top: 0;
                 margin-bottom: 10px;
                 border-bottom: none; /* Remove underline from H4 */
                 font-size: 1.25em; /* Adjust heading size in definition */
                 font-weight: 600;
             }

        .highlight {
            background-color: var(--highlight-color);
            padding: 3px 8px; /* More padding */
            border-radius: 5px;
            font-weight: 500; /* Medium weight */
            border: 1px solid #f5c6cb; /* Border matching background */
             transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease;
        }
        html[data-theme="dark"] .highlight {
            border-color: var(--border-color);
        }

        .example {
            border: 1px dashed var(--example-border);
            padding: 20px 25px;
            margin-top: 25px;
            border-radius: 8px;
            background-color: var(--example-bg);
             transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease;
        }

            .example h4 {
                margin-top: 0;
                color: var(--secondary-color);
                font-weight: bold;
                 border-bottom: none; /* Remove underline */
            }

        /* --- Chart Container --- */
         .chart-container {
            margin: 30px auto; /* Center single chart */
            max-width: 600px; /* Limit width */
            background-color: var(--card-bg); /* Match card bg for better border look */
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            transition: background-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease, border-color var(--transition-speed) ease;
            text-align: center; /* Center canvas if smaller than container */
        }

        .chart-container h5 { /* Title for the chart */
             text-align: center;
             margin-bottom: 15px;
             font-size: 1.1em;
             color: var(--secondary-color);
             font-weight: 600;
        }
         canvas {
            max-width: 100%;
            height: auto !important; /* Override potential inline height from Chart.js for better responsiveness */
            display: block; /* Prevent extra space below canvas */
            margin: 0 auto; /* Center canvas within container */
         }


        /* --- Placeholder for Images --- */
        .placeholder-image {
            border: 2px dashed var(--placeholder-border);
            background-color: var(--placeholder-bg);
            color: var(--placeholder-text);
            padding: 40px 20px;
            margin: 20px auto;
            text-align: center;
            font-style: italic;
            border-radius: var(--border-radius);
            max-width: 100%;
        }


        /* --- Dark Mode Toggle Button --- */
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            left: 20px; /* Positioned left */
            z-index: 1001; /* Above nav */
            background-color: var(--card-bg);
            color: var(--primary-color);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--card-shadow);
            transition: all var(--transition-speed) ease, transform 0.2s ease;
            overflow: hidden; /* Hide the icon that's moving out */
        }
        .dark-mode-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--card-hover-shadow);
            color: var(--accent-color);
        }
        .dark-mode-toggle .fa-sun,
        .dark-mode-toggle .fa-moon {
             position: absolute;
             transition: transform var(--transition-speed) ease, opacity var(--transition-speed) ease;
        }

        /* Light mode: Sun is visible, Moon is hidden and moved */
        html:not([data-theme="dark"]) .dark-mode-toggle .fa-sun {
             transform: translateY(0) rotate(0deg);
             opacity: 1;
        }
        html:not([data-theme="dark"]) .dark-mode-toggle .fa-moon {
            transform: translateY(100%) rotate(180deg);
             opacity: 0;
        }

        /* Dark mode: Moon is visible, Sun is hidden and moved */
        html[data-theme="dark"] .dark-mode-toggle .fa-sun {
             transform: translateY(-100%) rotate(-180deg);
             opacity: 0;
         }
        html[data-theme="dark"] .dark-mode-toggle .fa-moon {
             transform: translateY(0) rotate(0deg);
             opacity: 1;
        }


        /* CSS Animations */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
             .container { max-width: 95%; padding: 0 20px; }
             main h2 { font-size: 1.8em; }
             main h3 { font-size: 1.4em; }
        }

        @media (max-width: 768px) {
             html { font-size: 95%; }
             .container { padding: 0 15px; }
             header h1 { font-size: 2.3em; }
             header { clip-path: none; border-radius: 0 0 10px 10px; padding: 30px 15px;}
             .credits { font-size: 0.85em; }
             nav { padding: 10px 5px; top: 10px;}
             nav ul { gap: 8px 12px; }
             nav ul li a { padding: 7px 14px; font-size: 0.95em;}
             main section { padding: 25px 30px; border-right-width: 6px; }
             main h2 { font-size: 1.7em; }
             main h3 { font-size: 1.3em; }
             .dark-mode-toggle { width: 45px; height: 45px; font-size: 1.3rem; top: 15px; left: 15px; }
             .formula-block { padding: 15px; }
             .chart-container { padding: 15px; } /* Adjust padding for container */
        }

        @media (max-width: 576px) {
             html { font-size: 90%; }
             header h1 { font-size: 2.0em; }
             .credits { font-size: 0.8em; }
             nav { padding: 8px 5px; }
             nav ul { gap: 6px 10px; padding-bottom: 8px; margin-bottom: -8px;}
             nav ul li a { padding: 6px 10px; font-size: 0.9em;}
             main section { padding: 20px 25px; border-right-width: 5px; }
             main h2 { font-size: 1.5em; }
             main h3 { font-size: 1.2em; }
             .formula-block { padding: 10px; }
             .formula-block div.math { font-size: 1.05em; }
             .dark-mode-toggle { width: 40px; height: 40px; font-size: 1.2rem; top: 10px; left: 10px; }
             .chart-container { padding: 10px; }
        }

         /* Katex alignment fix for baseline */
        .katex { vertical-align: baseline; }
        p .math, li .math { line-height: 1; } /* Prevent inline math from increasing line height too much */

    </style>
</head>
<body>

    <!-- Dark Mode Toggle Button -->
    <button id="darkModeToggle" class="dark-mode-toggle" aria-label="Toggle dark mode" aria-pressed="false">
        <i class="fas fa-sun"></i>
        <i class="fas fa-moon"></i>
    </button>

    <header>
        <h1>אינפי 2 - שיעור 7</h1>
        <div class="credits">קרדיטים לניב והלל</div>
    </header>

    <div class="container">
        <nav id="main-nav">
          <ul>
            <li><a href="#lebesgue-intro" class="nav-link" dir="rtl">מידה 0 ומשפט לבג</a></li>
            <li><a href="#measure-zero-def" class="nav-link" dir="rtl">הגדרה: מידה 0</a></li>
            <li><a href="#measure-zero-examples" class="nav-link" dir="rtl">דוגמאות: מידה 0</a></li>
            <li><a href="#lebesgue-theorem" class="nav-link" dir="rtl">משפט לבג</a></li>
            <li><a href="#integral-properties" class="nav-link" dir="rtl">תכונות האינטגרל</a></li>
            <li><a href="#prop-scalar" class="nav-link" dir="rtl">כפל בקבוע</a></li>
            <li><a href="#prop-sum" class="nav-link" dir="rtl">סכום פונקציות</a></li>
            <li><a href="#prop-product" class="nav-link" dir="rtl">מכפלת פונקציות</a></li>
            <li><a href="#prop-reciprocal" class="nav-link" dir="rtl">הופכי של פונקציה</a></li>
            <li><a href="#prop-restrict" class="nav-link" dir="rtl">צמצום קטע</a></li>
            <li><a href="#prop-additivity" class="nav-link" dir="rtl">אדיטיביות</a></li>
            <li><a href="#prop-notation" class="nav-link" dir="rtl">סימונים והכללות</a></li>
            <li><a href="#example-step" class="nav-link" dir="rtl">דוגמה: פונקציית מדרגה</a></li>
            <li><a href="#prop-nonnegative" class="nav-link" dir="rtl">אי-שליליות</a></li>
            <li><a href="#prop-monotonicity" class="nav-link" dir="rtl">מונוטוניות</a></li>
            <li><a href="#prop-strict-pos" class="nav-link" dir="rtl">חיוביות ממש</a></li>
            <li><a href="#prop-triangle" class="nav-link" dir="rtl">אי-שוויון המשולש</a></li>
            <li><a href="#ivt-integrals" class="nav-link" dir="rtl">משפט ערך הביניים לאינטגרלים</a></li>
          </ul>
        </nav>

        <main>
            <section id="lebesgue-intro">
                <h2>מידה 0, משפט לבג</h2>
                <p>את משפט המחץ אודות הקשר שבין אינטגרביליות לרציפות לא נוכיח.</p>
                <p>לפני שנציג אותו אנו זקוקים להגדרה.</p>
            </section>

            <section id="measure-zero-def">
                <h3>הגדרה: מידה 0</h3>
                <div class="definition">
                    <h4>מידה 0</h4>
                    <p>קבוצת נקודות <span class="math" dir="ltr">\(E \subseteq \mathbb{R}\)</span> נקראת בעלת <strong>מידה 0</strong>, אמ"מ לכל <span class="math" dir="ltr">\(\varepsilon > 0\)</span> יש סדרת קטעים <span class="math" dir="ltr">\(\{I_n\}_{n=1}^{\infty}\)</span> כך ש <span class="math" dir="ltr">\(E \subseteq \bigcup_{n=1}^{\infty} I_n\)</span> וסכום אורכי הקטעים קטן מ-<span class="math" dir="ltr">\(\varepsilon\)</span>.</p>
                    <div class="formula-block"><div class="math" dir="ltr">$$ \sum_{n=1}^\infty \text{length}(I_n) < \varepsilon $$</div></div>
                </div>
            </section>

            <section id="measure-zero-examples">
                <h3>דוגמאות: מידה 0</h3>
                <div class="example">
                    <h4>קבוצה סופית</h4>
                    <p>כל קבוצה סופית <span class="math" dir="ltr">\(\{a_1, a_2, \dots, a_k\}\)</span> היא בעלת מידה 0.</p>
                    <p>הוכחה: יהי <span class="math" dir="ltr">\(\varepsilon > 0\)</span>. ניקח סביב כל <span class="math" dir="ltr">\(a_i\)</span> קטע <span class="math" dir="ltr">\(I_i\)</span> באורך <span class="math" dir="ltr">\(\frac{\varepsilon}{k}\)</span>. אז <span class="math" dir="ltr">\(\{a_1, \dots, a_k\} \subseteq \bigcup_{i=1}^k I_i\)</span> וסכום האורכים הוא <span class="math" dir="ltr">\(\sum_{i=1}^k \frac{\varepsilon}{k} = k \cdot \frac{\varepsilon}{k} = \varepsilon\)</span>. (כדי לקבל <span class="math" dir="ltr"><< \varepsilon\)</span>, ניקח קטעים באורך <span class="math" dir="ltr">\(\frac{\varepsilon}{2k}\)</span>).
                </p></div>
                 <div class="example">
                    <h4>קבוצה בת מניה</h4>
                    <p>כל קבוצה בת מנייה <span class="math" dir="ltr">\(\{b_1, b_2, b_3, \dots\}\)</span> היא בעלת מידה 0.</p>
                    <p>הוכחה: יהי <span class="math" dir="ltr">\(\varepsilon > 0\)</span>. נקח סביב כל <span class="math" dir="ltr">\(b_i\)</span> קטע <span class="math" dir="ltr">\(I_i\)</span> באורך <span class="math" dir="ltr">\(\frac{\varepsilon}{2^i}\)</span>. אז <span class="math" dir="ltr">\(\{b_n\}_{n=1}^\infty \subseteq \bigcup_{n=1}^\infty I_n\)</span> וסכום האורכים הוא:</p>
                    <div class="formula-block"><div class="math" dir="ltr">$$ \sum_{n=1}^\infty \text{length}(I_n) = \sum_{n=1}^\infty \frac{\varepsilon}{2^n} = \varepsilon \sum_{n=1}^\infty \left(\frac{1}{2}\right)^n = \varepsilon \cdot \frac{1/2}{1-1/2} = \varepsilon \cdot 1 = \varepsilon $$</div></div>
                     <p>(כדי לקבל <span class="math" dir="ltr"><< \varepsilon\)</span>, ניקח למשל קטעים באורך <span class="math" dir="ltr">\(\frac{\varepsilon}{2^{i+1}}\)</span>).</p>
                     <p>לדוגמה, קבוצת המספרים הרציונליים <span class="math" dir="ltr">\(\mathbb{Q}\)</span> היא בת מנייה ולכן בעלת מידה 0.</p>
                 </div>
            </section>

            <section id="lebesgue-theorem">
                <h2>משפט לבג</h2>
                <div class="definition">
                    <h4>משפט לבג</h4>
                    <p>פונקציה חסומה בקטע <span class="math" dir="ltr">\([a,b]\)</span> היא אינטגרבילית רימן <span class="math" dir="ltr">\(\iff\)</span> קבוצת נקודות אי הרציפות שלה בעלת מידה 0.</p>
                </div>
                 <p><strong>הערה:</strong> לפי משפט לבג קל להוכיח המשפט מס' 27 משיעור 6 (שאם <span class="math" dir="ltr">\(f\)</span> אינטגרבילית ו-<span class="math" dir="ltr">\(f^*\)</span> שונה ממנה במספר סופי של נקודות אז <span class="math" dir="ltr">\(f^*\)</span> אינטגרבילית ו-<span class="math" dir="ltr">\(\int f = \int f^*\)</span>).</p>
                 <p><strong>הוכחה (בעזרת לבג):</strong></p>
                 <ul>
                     <li><strong>כיוון (<span class="math" dir="ltr">\(\Leftarrow\)</span>):</strong> אם <span class="math" dir="ltr">\(f\)</span> אינטגרבילית, אז לפי לבג, קבוצת נקודות אי הרציפות שלה, <span class="math" dir="ltr">\(D_f\)</span>, בעלת מידה 0. קבוצת נקודות אי הרציפות של <span class="math" dir="ltr">\(f^*\)</span>, <span class="math" dir="ltr">\(D_{f^*}\)</span>, שונה מ-<span class="math" dir="ltr">\(D_f\)</span> רק במספר סופי של נקודות (אלו שבהן <span class="math" dir="ltr">\(f \ne f^*\)</span>, ונקודות שבהן <span class="math" dir="ltr">\(f\)</span> רציפה אך <span class="math" dir="ltr">\(f^*\)</span> לא, או להפך). איחוד של קבוצה בעלת מידה 0 עם קבוצה סופית (שהיא גם בעלת מידה 0) הוא קבוצה בעלת מידה 0. לכן <span class="math" dir="ltr">\(D_{f^*}\)</span> בעלת מידה 0, ולפי לבג, <span class="math" dir="ltr">\(f^*\)</span> אינטגרבילית.</li>
                     <li><strong>שוויון האינטגרלים:</strong> כמובן ש-<span class="math" dir="ltr">\(\int_a^b f(x) dx = \int_a^b f^*(x) dx\)</span>. ניקח סדרת חלוקות נורמליות <span class="math" dir="ltr">\(\{T_n\}\)</span> (<span class="math" dir="ltr">\(\lambda(T_n) \to 0\)</span>). ניתן לבחור בכל תת-קטע <span class="math" dir="ltr">\(\Delta x_i\)</span> נקודה <span class="math" dir="ltr">\(\zeta_i\)</span> שבה <span class="math" dir="ltr">\(f(\zeta_i) = f^*(\zeta_i)\)</span> (זה אפשרי כל עוד רוחב הקטע קטן מספיק כדי שלא יכיל רק נקודות שבהן הן שונות). כך נקבל עבור סדרת חלוקות נורמליות סידרת סכומי רימן זהים עבור שתי הפונקציות, השואפים כמובן לאותו גבול.</li>
                </ul>
            </section>

            <section id="integral-properties">
                 <h2>תכונות האינטגרל המסוים</h2>
                 <p>נחזור לשגרת המשפטים ה'רגילים'.</p>

                 <h3 id="prop-scalar">1. כפל בקבוע</h3>
                 <p>אם <span class="math" dir="ltr">\(f\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([a,b]\)</span>, ובנוסף <span class="math" dir="ltr">\(c\)</span> הוא קבוע, אז <span class="math" dir="ltr">\(cf\)</span> אינטגרבילית ו-</p>
                 <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b c f(x) dx = c \int_a^b f(x) dx $$</div></div>
                 <p><strong>הוכחה:</strong> כל סכום רימן <span class="math" dir="ltr">\(\sigma(cf, T, \{\zeta_i\}) = \sum (c f(\zeta_i)) \Delta x_i = c \sum f(\zeta_i) \Delta x_i = c \cdot \sigma(f, T, \{\zeta_i\})\)</span>. כאשר <span class="math" dir="ltr">\(\lambda(T) \to 0\)</span>, אגף ימין שואף ל-<span class="math" dir="ltr">\(c \int_a^b f dx\)</span>, ולכן גם אגף שמאל, שפירושו <span class="math" dir="ltr">\(cf\)</span> אינטגרבילית ושערך האינטגרל הוא <span class="math" dir="ltr">\(c \int_a^b f dx\)</span>.</p>

                 <h3 id="prop-sum">2. סכום פונקציות</h3>
                 <p>אם <span class="math" dir="ltr">\(f, h\)</span> אינטגרביליות ב-<span class="math" dir="ltr">\([a,b]\)</span> אז גם <span class="math" dir="ltr">\(f+h\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([a,b]\)</span> ו-</p>
                 <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b (f(x)+h(x)) dx = \int_a^b f(x) dx + \int_a^b h(x) dx $$</div></div>
                 <p><strong>הוכחה:</strong> שוב, כל סכום רימן <span class="math" dir="ltr">\(\sigma(f+h, T, \{\zeta_i\}) = \sum (f(\zeta_i)+h(\zeta_i)) \Delta x_i = \sum f(\zeta_i) \Delta x_i + \sum h(\zeta_i) \Delta x_i = \sigma(f, T, \{\zeta_i\}) + \sigma(h, T, \{\zeta_i\})\)</span>. כאשר <span class="math" dir="ltr">\(\lambda(T) \to 0\)</span>, אגף ימין שואף לסכום האינטגרלים, ולכן גם אגף שמאל.</p>

                 <h3 id="prop-product">3. מכפלת פונקציות</h3>
                 <p>אם <span class="math" dir="ltr">\(f, h\)</span> אינטגרביליות ב-<span class="math" dir="ltr">\([a,b]\)</span> אז גם <span class="math" dir="ltr">\(f \cdot h\)</span> אינטגרבילית שם (אך אין נוסחה כללית ל-<span class="math" dir="ltr">\(\int_a^b f(x) h(x) dx\)</span>).</p>
                 <p><strong>הוכחה:</strong>
                 נשתמש בקריטריון רימן לאינטגרביליות. נניח ש-<span class="math" dir="ltr">\(f, h\)</span> אינטגרביליות, לכן הן חסומות. נסמן <span class="math" dir="ltr">\(|f(x)| \le K\)</span> ו-<span class="math" dir="ltr">\(|h(x)| \le L\)</span> לכל <span class="math" dir="ltr">\(x \in [a,b]\)</span>.
                 לכל <span class="math" dir="ltr">\(x, z \in [a,b]\)</span> מתקיים:
                 </p>
                 <div class="formula-block"><div class="math" dir="ltr">$$ \begin{aligned} |(f \cdot h)(z) - (f \cdot h)(x)| &= |f(z)h(z) - f(x)h(x)| \\ &= |f(z)h(z) - f(x)h(z) + f(x)h(z) - f(x)h(x)| \\ &= |(f(z)-f(x))h(z) + f(x)(h(z)-h(x))| \\ &\le |f(z)-f(x)| |h(z)| + |f(x)| |h(z)-h(x)| \\ &\le |f(z)-f(x)| \cdot L + K \cdot |h(z)-h(x)| \end{aligned} $$</div></div>
                 <p>
                 אם נסמן את התנודה של <span class="math" dir="ltr">\(f\)</span> בקטע <span class="math" dir="ltr">\(I \subseteq [a,b]\)</span> ב-<span class="math" dir="ltr">\(\omega_I(f)\)</span> ובדומה עבור <span class="math" dir="ltr">\(h\)</span> ו-<span class="math" dir="ltr">\(f \cdot h\)</span>, נקבל מהאי-שוויון לעיל שלכל קטע <span class="math" dir="ltr">\(I \subseteq [a,b]\)</span>:
                 </p>
                 <div class="formula-block"><div class="math" dir="ltr">$$ (\star) \quad \omega_I(f \cdot h) \le L \cdot \omega_I(f) + K \cdot \omega_I(h) $$</div></div>
                  <p>תהי כעת <span class="math" dir="ltr">\(T = \{x_0, x_1, \dots, x_k\}\)</span> חלוקה של <span class="math" dir="ltr">\([a,b]\)</span> עם הסימונים המקובלים. אז סכום רימן העליון פחות התחתון עבור <span class="math" dir="ltr">\(f \cdot h\)</span> מקיים:</p>
                  <div class="formula-block"><div class="math" dir="ltr">$$ \begin{aligned} S_T(f \cdot h) - s_T(f \cdot h) &= \sum_{i=1}^k \omega_{\Delta x_i}(f \cdot h) \Delta x_i \\ &\le \sum_{i=1}^k (L \cdot \omega_{\Delta x_i}(f) + K \cdot \omega_{\Delta x_i}(h)) \Delta x_i \quad (\text{using } \star) \\ &= L \sum_{i=1}^k \omega_{\Delta x_i}(f) \Delta x_i + K \sum_{i=1}^k \omega_{\Delta x_i}(h) \Delta x_i \\ &= L (S_T(f) - s_T(f)) + K (S_T(h) - s_T(h)) \end{aligned} $$</div></div>
                 <p>
                 מכיוון ש-<span class="math" dir="ltr">\(f, h\)</span> אינטגרביליות, לכל <span class="math" dir="ltr">\(\varepsilon > 0\)</span> קיימת חלוקה <span class="math" dir="ltr">\(T\)</span> (או שעבור <span class="math" dir="ltr">\(\lambda(T) \to 0\)</span>) כך ש-<span class="math" dir="ltr">\(S_T(f) - s_T(f) \to 0\)</span> ו-<span class="math" dir="ltr">\(S_T(h) - s_T(h) \to 0\)</span>.
                 לכן, עבור אותה חלוקה <span class="math" dir="ltr">\(T\)</span> (או כאשר <span class="math" dir="ltr">\(\lambda(T) \to 0\)</span>), גם <span class="math" dir="ltr">\(S_T(f \cdot h) - s_T(f \cdot h) \to L \cdot 0 + K \cdot 0 = 0\)</span>.
                 כמובן <span class="math" dir="ltr">\(f \cdot h\)</span> חסומה (כי <span class="math" dir="ltr">\(|f \cdot h| \le K \cdot L\)</span>), ולפי קריטריון רימן, <span class="math" dir="ltr">\(f \cdot h\)</span> אינטגרבילית.
                 </p>

                 <h3 id="prop-reciprocal">4. הופכי של פונקציה</h3>
                  <p>אם <span class="math" dir="ltr">\(h\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([a,b]\)</span> וגם <span class="math" dir="ltr">\(|h(x)| \ge c\)</span> עבור <span class="math" dir="ltr">\(c > 0\)</span> קבוע, אז <span class="math" dir="ltr">\(1/h\)</span> אינטגרבילית.</p>
                  <p><strong>הוכחה:</strong>
                  תחילה, <span class="math" dir="ltr">\(|1/h(x)| \le 1/c\)</span>, לכן <span class="math" dir="ltr">\(1/h\)</span> חסומה.
                  בנוסף, לכל <span class="math" dir="ltr">\(x, z \in [a,b]\)</span>:
                  </p>
                  <div class="formula-block"><div class="math" dir="ltr">$$ \left| \frac{1}{h(z)} - \frac{1}{h(x)} \right| = \left| \frac{h(x) - h(z)}{h(x) h(z)} \right| = \frac{|h(x) - h(z)|}{|h(x)| |h(z)|} \le \frac{|h(x) - h(z)|}{c \cdot c} = \frac{|h(x) - h(z)|}{c^2} $$</div></div>
                 <p>לכן, לכל קטע <span class="math" dir="ltr">\(I \subseteq [a,b]\)</span>,</p>
                 <div class="formula-block"><div class="math" dir="ltr">$$ \omega_I(1/h) \le \frac{1}{c^2} \omega_I(h) $$</div></div>
                  <p>ואז לכל חלוקה <span class="math" dir="ltr">\(T\)</span>:</p>
                 <div class="formula-block"><div class="math" dir="ltr">$$ 0 \le S_T(1/h) - s_T(1/h) = \sum_{i=1}^k \omega_{\Delta x_i}(1/h) \Delta x_i \le \sum_{i=1}^k \frac{1}{c^2} \omega_{\Delta x_i}(h) \Delta x_i = \frac{1}{c^2} (S_T(h) - s_T(h)) $$</div></div>
                 <p>מכיוון ש-<span class="math" dir="ltr">\(h\)</span> אינטגרבילית, <span class="math" dir="ltr">\(S_T(h) - s_T(h) \to 0\)</span> כאשר <span class="math" dir="ltr">\(\lambda(T) \to 0\)</span>. לפי משפט הסנדוויץ', גם <span class="math" dir="ltr">\(S_T(1/h) - s_T(1/h) \to 0\)</span>. מכיוון ש-<span class="math" dir="ltr">\(1/h\)</span> חסומה, היא אינטגרבילית לפי קריטריון רימן.</p>
                  <p><strong>הערה:</strong> אם אין <span class="math" dir="ltr">\(c>0\)</span> כך ש-<span class="math" dir="ltr">\(|h(x)| \ge c\)</span> לכל <span class="math" dir="ltr">\(x\)</span>, אז <span class="math" dir="ltr">\(1/h\)</span> לא חסומה (כי <span class="math" dir="ltr">\(h\)</span> מתקרבת ל-0) ובוודאי אינה אינטגרבילית. לכן, התנאי <span class="math" dir="ltr">\(|h(x)| \ge c > 0\)</span> הוא תנאי הכרחי ומספיק לאינטגרביליות של <span class="math" dir="ltr">\(1/h\)</span>, בהינתן ש-<span class="math" dir="ltr">\(h\)</span> אינטגרבילית.</p>
                 <p><strong>מסקנה:</strong> אם <span class="math" dir="ltr">\(f, h\)</span> אינטגרביליות ו-<span class="math" dir="ltr">\(|h(x)| \ge c > 0\)</span>, אז גם <span class="math" dir="ltr">\(f/h\)</span> אינטגרבילית (כי <span class="math" dir="ltr">\(f/h = f \cdot (1/h)\)</span> ולפי סעיפים (3) ו-(4)).</p>

                 <h3 id="prop-restrict">5. צמצום קטע</h3>
                  <p>אם <span class="math" dir="ltr">\(f\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([a,b]\)</span> ו-<span class="math" dir="ltr">\([a,b] \supseteq [\alpha, \beta]\)</span>, אז <span class="math" dir="ltr">\(f\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([\alpha, \beta]\)</span>.</p>
                  <p><strong>הוכחה:</strong>
                  ודאי <span class="math" dir="ltr">\(f\)</span> חסומה ב-<span class="math" dir="ltr">\([\alpha, \beta]\)</span> (כי היא חסומה ב-<span class="math" dir="ltr">\([a,b]\)</span>).
                  תהי כעת <span class="math" dir="ltr">\(T'\)</span> חלוקה של <span class="math" dir="ltr">\([\alpha, \beta]\)</span>. ניתן, על ידי הוספת נקודות מימין ל-<span class="math" dir="ltr">\(\beta\)</span> (עד <span class="math" dir="ltr">\(b\)</span>) ומשמאל ל-<span class="math" dir="ltr">\(\alpha\)</span> (עד <span class="math" dir="ltr">\(a\)</span>), להשלים אותה לחלוקה <span class="math" dir="ltr">\(T\)</span> של <span class="math" dir="ltr">\([a,b]\)</span> כך ש-<span class="math" dir="ltr">\(\lambda(T) = \lambda(T')\)</span> (כלומר, לא להוסיף נקודות שיוצרות קטעים ארוכים יותר מאלו שב-<span class="math" dir="ltr">\(T'\)</span>, או פשוט להבטיח ש-<span class="math" dir="ltr">\(\lambda(T)\)</span> קטן כרצוננו אם <span class="math" dir="ltr">\(\lambda(T')\)</span> קטן כרצוננו).
                   אז סכום רימן (הפרש עליון-תחתון) עבור <span class="math" dir="ltr">\(f\)</span> מעל <span class="math" dir="ltr">\(T'\)</span> מקיים:
                  </p>
                   <div class="formula-block"><div class="math" dir="ltr">$$ 0 \le \sum_{i \in T'} \omega_{\Delta x_i}(f) \Delta x_i \le \sum_{i \in T} \omega_{\Delta x_i}(f) \Delta x_i = S_T(f) - s_T(f) $$</div></div>
                   <p>כאשר <span class="math" dir="ltr">\(\lambda(T') \to 0\)</span>, ניתן להבטיח שגם <span class="math" dir="ltr">\(\lambda(T) \to 0\)</span>. מכיוון ש-<span class="math" dir="ltr">\(f\)</span> אינטגרבילית על <span class="math" dir="ltr">\([a,b]\)</span>, אז <span class="math" dir="ltr">\(S_T(f) - s_T(f) \to 0\)</span>. לפי משפט הסנדוויץ', גם <span class="math" dir="ltr">\(\sum_{i \in T'} \omega_{\Delta x_i}(f) \Delta x_i = S_{T'}(f) - s_{T'}(f) \to 0\)</span>.
                   מכיוון ש-<span class="math" dir="ltr">\(f\)</span> חסומה על <span class="math" dir="ltr">\([\alpha, \beta]\)</span>, היא אינטגרבילית על <span class="math" dir="ltr">\([\alpha, \beta]\)</span> לפי קריטריון רימן.</p>

                 <h3 id="prop-additivity">6. אדיטיביות על קטעים</h3>
                  <p>אם <span class="math" dir="ltr">\(a < c < b\)</span>, ו-<span class="math" dir="ltr">\(f\)</span> אינטגרבילית על <span class="math" dir="ltr">\([a,c]\)</span> ועל <span class="math" dir="ltr">\([c,b]\)</span>, אז <span class="math" dir="ltr">\(f\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([a,b]\)</span> ו-</p>
                  <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b f(x) dx = \int_a^c f(x) dx + \int_c^b f(x) dx $$</div></div>
                  <p><strong>הוכחה:</strong> (רעיון דומה לסעיפים 16-17 בשיעור 6)</p>
                  <p><strong>אינטגרביליות:</strong> ודאי <span class="math" dir="ltr">\(f\)</span> חסומה על <span class="math" dir="ltr">\([a,b]\)</span> (כי היא חסומה בכל תת-קטע). יהי <span class="math" dir="ltr">\(\varepsilon > 0\)</span>. לפי הנתון, קיימת חלוקה <span class="math" dir="ltr">\(T_1\)</span> של <span class="math" dir="ltr">\([a,c]\)</span> כך ש-<span class="math" dir="ltr">\(S_{T_1}(f) - s_{T_1}(f) < \varepsilon/2\)</span>. בדומה, קיימת חלוקה <span class="math" dir="ltr">\(T_2\)</span> של <span class="math" dir="ltr">\([c,b]\)</span> כך ש-<span class="math" dir="ltr">\(S_{T_2}(f) - s_{T_2}(f) < \varepsilon/2\)</span>.
                  נגדיר <span class="math" dir="ltr">\(T \stackrel{\text{def}}{=} T_1 \cup T_2\)</span>. זוהי חלוקה של <span class="math" dir="ltr">\([a,b]\)</span>. מתקיים:
                  </p>
                   <div class="formula-block"><div class="math" dir="ltr">$$ S_T(f) = S_{T_1}(f) + S_{T_2}(f) $$</div></div>
                   <div class="formula-block"><div class="math" dir="ltr">$$ s_T(f) = s_{T_1}(f) + s_{T_2}(f) $$</div></div>
                  <p>ולכן</p>
                  <div class="formula-block"><div class="math" dir="ltr">$$ S_T(f) - s_T(f) = (S_{T_1}(f) - s_{T_1}(f)) + (S_{T_2}(f) - s_{T_2}(f)) < \frac{\varepsilon}{2} + \frac{\varepsilon}{2} = \varepsilon $$</div></div>
                  <p>לפי קריטריון רימן, <span class="math" dir="ltr">\(f\)</span> אינטגרבילית על <span class="math" dir="ltr">\([a,b]\)</span>.</p>
                  <p><strong>שוויון האינטגרלים:</strong> ניקח סדרת חלוקות נורמליות <span class="math" dir="ltr">\(\{T_{n,1}\}_{n=1}^\infty\)</span> עבור <span class="math" dir="ltr">\([a,c]\)</span> וסדרת חלוקות נורמליות <span class="math" dir="ltr">\(\{T_{n,2}\}_{n=1}^\infty\)</span> עבור <span class="math" dir="ltr">\([c,b]\)</span>. לכל <span class="math" dir="ltr">\(n\)</span>, נבחר נקודות <span class="math" dir="ltr">\(\{\zeta_{i,1}\}\)</span> ב-<span class="math" dir="ltr">\(T_{n,1}\)</span> ו-<span class="math" dir="ltr">\(\{\zeta_{i,2}\}\)</span> ב-<span class="math" dir="ltr">\(T_{n,2}\)</span>, ונגדיר את סכומי רימן <span class="math" dir="ltr">\(\sigma_{n,1}\)</span> ו-<span class="math" dir="ltr">\(\sigma_{n,2}\)</span> בהתאמה.
                  נגדיר <span class="math" dir="ltr">\(T_n = T_{n,1} \cup T_{n,2}\)</span>. זו סדרת חלוקות נורמליות של <span class="math" dir="ltr">\([a,b]\)</span> (כי <span class="math" dir="ltr">\(\lambda(T_n) = \max(\lambda(T_{n,1}), \lambda(T_{n,2})) \to 0\)</span>).
                  סכום רימן המתאים ל-<span class="math" dir="ltr">\(T_n\)</span> עם הנקודות <span class="math" dir="ltr">\(\{\zeta_{i,1}\} \cup \{\zeta_{i,2}\}\)</span> הוא <span class="math" dir="ltr">\(\sigma_n = \sigma_{n,1} + \sigma_{n,2}\)</span>.
                  כאשר <span class="math" dir="ltr">\(n \to \infty\)</span>:
                  </p>
                  <div class="formula-block"><div class="math" dir="ltr">$$ \underbrace{\sigma_n}_{\to \int_a^b f dx} = \underbrace{\sigma_{n,1}}_{\to \int_a^c f dx} + \underbrace{\sigma_{n,2}}_{\to \int_c^b f dx} $$</div></div>
                 <p>ומכאן נובע השוויון המבוקש.</p>

                 <h3 id="prop-notation">7. סימונים והכללות</h3>
                 <p><strong>סימון:</strong></p>
                 <ul>
                   <li>אם <span class="math" dir="ltr">\(a > b\)</span> ו-<span class="math" dir="ltr">\(f\)</span> אינטגרבילית על <span class="math" dir="ltr">\([b,a]\)</span>, נסמן:</li>
                   <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b f(x) dx = - \int_b^a f(x) dx $$</div></div>
                   <li>אם <span class="math" dir="ltr">\(b = a\)</span>, אז נגדיר כמצופה:</li>
                    <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^a f(x) dx = 0 $$</div></div>
                 </ul>
                 <p><strong>טענה:</strong> בסימונים אלו נכונה הנוסחה <span class="math" dir="ltr">\(\int_a^b f(x) dx = \int_a^c f(x) dx + \int_c^b f(x) dx\)</span> בכל סדר של הנקודות <span class="math" dir="ltr">\(a, b, c\)</span>, בתנאי ש-<span class="math" dir="ltr">\(f\)</span> מוגדרת ואינטגרבילית בכל הקטעים הרלוונטיים (שחלקם אולי "ברברס").</p>
                 <p><strong>הוכחה:</strong> יש <span class="math" dir="ltr">\(3! = 6\)</span> אפשרויות לסדר הנקודות:</p>
                 <ol>
                     <li><span class="math" dir="ltr">\(a<c<b\)</span>: זו הטענה בסעיף 6.</li>
                     <li><span class="math" dir="ltr">\(a<b<c\)</span>: אנחנו רוצים להוכיח <span class="math" dir="ltr">\(\int_a^b = \int_a^c + \int_c^b\)</span>. לפי סעיף 6, <span class="math" dir="ltr">\(\int_a^c = \int_a^b + \int_b^c\)</span>. נעביר אגפים: <span class="math" dir="ltr">\(\int_a^b = \int_a^c - \int_b^c = \int_a^c + \int_c^b\)</span> (לפי הסימון החדש).</li>
                     <li><span class="math" dir="ltr">\(b<a<c\)</span>: רוצים <span class="math" dir="ltr">\(\int_a^b = \int_a^c + \int_c^b\)</span>. לפי 6, <span class="math" dir="ltr">\(\int_b^c = \int_b^a + \int_a^c\)</span>. נעביר: <span class="math" dir="ltr">\(\int_b^a = \int_b^c - \int_a^c\)</span>. נהפוך סימנים: <span class="math" dir="ltr">\(-\int_a^b = -\int_c^b - (-\int_c^a)\)</span>. נכפיל ב-<span class="math" dir="ltr">\(-1\)</span>: <span class="math" dir="ltr">\(\int_a^b = \int_c^b - \int_c^a = -\int_b^c + \int_a^c\)</span>. לא בדיוק מה שרצינו. ננסה אחרת: <span class="math" dir="ltr">\(\int_b^c = \int_b^a + \int_a^c \Rightarrow \int_a^b = -\int_b^a = -(\int_b^c - \int_a^c) = \int_a^c - \int_b^c = \int_a^c + \int_c^b\)</span>. זה עובד.</li>
                     <li><span class="math" dir="ltr">\(b<c<a\)</span>: רוצים <span class="math" dir="ltr">\(\int_a^b = \int_a^c + \int_c^b\)</span>. לפי 6, <span class="math" dir="ltr">\(\int_b^a = \int_b^c + \int_c^a\)</span>. אז <span class="math" dir="ltr">\(\int_a^b = -\int_b^a = -(\int_b^c + \int_c^a) = -\int_b^c - \int_c^a = \int_c^b + \int_a^c\)</span>. עובד.</li>
                     <li><span class="math" dir="ltr">\(c<a<b\)</span>: רוצים <span class="math" dir="ltr">\(\int_a^b = \int_a^c + \int_c^b\)</span>. לפי 6, <span class="math" dir="ltr">\(\int_c^b = \int_c^a + \int_a^b\)</span>. נעביר: <span class="math" dir="ltr">\(\int_a^b = \int_c^b - \int_c^a = \int_c^b + \int_a^c\)</span>. עובד.</li>
                     <li><span class="math" dir="ltr">\(c<b<a\)</span>: רוצים <span class="math" dir="ltr">\(\int_a^b = \int_a^c + \int_c^b\)</span>. לפי 6, <span class="math" dir="ltr">\(\int_c^a = \int_c^b + \int_b^a\)</span>. נעביר: <span class="math" dir="ltr">\(\int_c^b = \int_c^a - \int_b^a\)</span>. אז <span class="math" dir="ltr">\(\int_a^c + \int_c^b = \int_a^c + (\int_c^a - \int_b^a) = \int_a^c - \int_a^c - \int_b^a = -\int_b^a = \int_a^b\)</span>. עובד.</li>
                 </ol>
                 <p><strong>טענת המשך:</strong> בתנאים דומים נכונה הנוסחה הבאה לכל <span class="math" dir="ltr">\(n \ge 1\)</span>:</p>
                 <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b f(x) dx = \int_a^{c_1} f(x) dx + \int_{c_1}^{c_2} f(x) dx + \dots + \int_{c_n}^b f(x) dx $$</div></div>
                 <p>(כאשר <span class="math" dir="ltr">\(a, c_1, c_2, \dots, c_n, b\)</span> הן נקודות כלשהן).</p>
                 <p><strong>הוכחה:</strong> באינדוקציה על <span class="math" dir="ltr">\(n\)</span>.
                 <ul>
                    <li>בסיס (<span class="math" dir="ltr">\(n=1\)</span>): <span class="math" dir="ltr">\(\int_a^b = \int_a^{c_1} + \int_{c_1}^b\)</span>. זו הטענה הקודמת עם <span class="math" dir="ltr">\(c=c_1\)</span>.</li>
                    <li>הנחה: נניח נכון עבור <span class="math" dir="ltr">\(n=k-1\)</span>.</li>
                    <li>צעד (<span class="math" dir="ltr">\(n=k\)</span>):
                       <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^{c_1} + \int_{c_1}^{c_2} + \dots + \int_{c_{k-1}}^{c_k} + \int_{c_k}^b $$</div></div>
                        לפי הנחת האינדוקציה עבור הנקודות <span class="math" dir="ltr">\(a, c_1, \dots, c_{k-1}, c_k\)</span>:
                       <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^{c_k} = \int_a^{c_1} + \dots + \int_{c_{k-1}}^{c_k} $$</div></div>
                       לכן הסכום המקורי הוא:
                        <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^{c_k} + \int_{c_k}^b $$</div></div>
                        ולפי הטענה הקודמת (עם <span class="math" dir="ltr">\(a, c_k, b\)</span>), זה שווה ל-<span class="math" dir="ltr">\(\int_a^b\)</span>. מש"ל.
                    </li>
                 </ul>
                 </p>
            </section>

            <section id="example-step">
                <h3>8. דוגמה: פונקציית מדרגה</h3>
                <p>תהי <span class="math" dir="ltr">\(f(x) = \begin{cases} 1, & 0 \le x \le 1 \\ 2, & 1 < x \le 2 \end{cases}\)</span>.</p>
                <div class="chart-container">
                     <h5>גרף הפונקציה <span class="math" dir="ltr">\(f(x)\)</span></h5>
                     <canvas id="stepFunctionChart"></canvas>
                </div>
                 <p><span class="math" dir="ltr">\(f\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([0,1]\)</span> (כי היא קבועה שם) וב-<span class="math" dir="ltr">\([1,2]\)</span> (כי היא קבועה שם, למעט נקודה אחת <span class="math" dir="ltr">\(x=1\)</span> שבה היא לא מוגדרת לפי ההגדרה השנייה, אך ניתן להגדיר <span class="math" dir="ltr">\(f(1)=1\)</span> או <span class="math" dir="ltr">\(f(1)=2\)</span>, זה לא משנה לאינטגרביליות ולערך האינטגרל. יש לה נקודת אי רציפות אחת ב-<span class="math" dir="ltr">\(x=1\)</span> בקטע <span class="math" dir="ltr">\([0,2]\)</span>, ולכן היא אינטגרבילית גם ב-<span class="math" dir="ltr">\([0,2]\)</span>).</p>
                 <p>לפי סעיף 6, <span class="math" dir="ltr">\( \int_0^2 f(x) dx = \int_0^1 f(x) dx + \int_1^2 f(x) dx \)</span>.</p>
                 <ul>
                   <li><span class="math" dir="ltr">\(\int_0^1 f(x) dx = \int_0^1 1 dx = 1 \cdot (1-0) = 1\)</span>.</li>
                   <li><span class="math" dir="ltr">\(\int_1^2 f(x) dx = \int_1^2 2 dx = 2 \cdot (2-1) = 2\)</span> (הערך ב-<span class="math" dir="ltr">\(x=1\)</span> לא משנה לאינטגרל).</li>
                 </ul>
                 <p>בסה"כ <span class="math" dir="ltr">\( \int_0^2 f(x) dx = 1 + 2 = 3 \)</span>. הגיוני מאוד ואפילו נכון (זה השטח של שני מלבנים).</p>
            </section>

            <section id="prop-nonnegative">
                 <h3>9. אי-שליליות</h3>
                 <p>אם <span class="math" dir="ltr">\(f\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([a,b]\)</span> ו-<span class="math" dir="ltr">\(f(x) \ge 0\)</span> ב-<span class="math" dir="ltr">\([a,b]\)</span>, אז <span class="math" dir="ltr">\(\int_a^b f(x) dx \ge 0\)</span>.</p>
                 <p><strong>הוכחה:</strong> כל סכום רימן <span class="math" dir="ltr">\(\sigma(f, T, \{\zeta_i\}) = \sum f(\zeta_i) \Delta x_i\)</span> הוא אי-שלילי (כי <span class="math" dir="ltr">\(f(\zeta_i) \ge 0\)</span> ו-<span class="math" dir="ltr">\(\Delta x_i > 0\)</span>). הגבול של סדרה אי-שלילית הוא אי-שלילי.</p>
            </section>

             <section id="prop-monotonicity">
                 <h3>10. מונוטוניות</h3>
                 <p>אם <span class="math" dir="ltr">\(f \ge g\)</span> ב-<span class="math" dir="ltr">\([a,b]\)</span> ושתיהן אינטגרביליות, אז <span class="math" dir="ltr">\(\int_a^b f(x) dx \ge \int_a^b g(x) dx\)</span>.</p>
                 <p><strong>הוכחה:</strong> נגדיר <span class="math" dir="ltr">\(h(x) = f(x) - g(x)\)</span>. אז <span class="math" dir="ltr">\(h(x) \ge 0\)</span> ב-<span class="math" dir="ltr">\([a,b]\)</span>. הפונקציה <span class="math" dir="ltr">\(h\)</span> אינטגרבילית (לפי סעיפים 2, 1). לכן, לפי סעיף 9:</p>
                 <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b h(x) dx \ge 0 $$</div></div>
                 <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b (f(x) - g(x)) dx \ge 0 $$</div></div>
                 <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b f(x) dx - \int_a^b g(x) dx \ge 0 $$</div></div>
                 <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b f(x) dx \ge \int_a^b g(x) dx $$</div></div>
            </section>

            <section id="prop-strict-pos">
                <h3>11. חיוביות ממש</h3>
                <p>מעניין יותר הוא המשפט הבא:</p>
                <p><strong>משפט:</strong> אם <span class="math" dir="ltr">\(f\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([a,b]\)</span> ו-<span class="math" dir="ltr">\(f(x) > 0\)</span> לכל <span class="math" dir="ltr">\(x \in [a,b]\)</span>, אז <span class="math" dir="ltr">\(\int_a^b f(x) dx > 0\)</span>.</p>
                <p><strong>הוכחה:</strong> נניח בשלילה שזה לא מתקיים. מכיוון שידוע (מסעיף 9) ש-<span class="math" dir="ltr">\(\int_a^b f(x) dx \ge 0\)</span>, ההנחה בשלילה היא ש-<span class="math" dir="ltr">\(\int_a^b f(x) dx = 0\)</span>.</p>
                <p>במצב כזה מתקיים:</p>
                 <ul>
                     <li>(א) לכל תת-קטע <span class="math" dir="ltr">\([\alpha, \beta] \subseteq [a,b]\)</span>, מתקיים <span class="math" dir="ltr">\(\int_\alpha^\beta f(x) dx = 0\)</span>.
                         (הסבר: <span class="math" dir="ltr">\(0 = \int_a^b f = \int_a^\alpha f + \int_\alpha^\beta f + \int_\beta^b f\)</span>. כל אחד מ-3 האינטגרלים באגף ימין אי-שלילי (כי <span class="math" dir="ltr">\(f \ge 0\)</span>). סכום של אי-שליליים הוא 0 רק אם כל אחד מהם הוא 0. בפרט, <span class="math" dir="ltr">\(\int_\alpha^\beta f dx = 0\)</span>).</li>
                    <li>(ב) לכל <span class="math" dir="ltr">\(\varepsilon > 0\)</span>, ניתן למצוא קטע <span class="math" dir="ltr">\(\Delta \subseteq [a,b]\)</span> (קטן כרצוננו) כך ש-<span class="math" dir="ltr">\(f(x) \le \varepsilon\)</span> לכל <span class="math" dir="ltr">\(x \in \Delta\)</span>.
                        (הסבר: לפי הגדרת אינטגרל רימן, <span class="math" dir="ltr">\(\lim_{\lambda(T) \to 0} S_T(f) = \int_a^b f dx = 0\)</span>, כאשר <span class="math" dir="ltr">\(S_T(f) = \sum_{i=1}^k M_i \Delta x_i\)</span> הוא הסכום העליון. עבור <span class="math" dir="ltr">\(\varepsilon' = \varepsilon (b-a)\)</span>, קיים <span class="math" dir="ltr">\(\delta > 0\)</span> כך שאם <span class="math" dir="ltr">\(\lambda(T) < \delta\)</span> אז <span class="math" dir="ltr">\(S_T(f) < \varepsilon'\)</span>. כלומר <span class="math" dir="ltr">\(\sum M_i \Delta x_i < \varepsilon (b-a)\)</span>. אם היה מתקיים <span class="math" dir="ltr">\(M_i \ge \varepsilon\)</span> לכל <span class="math" dir="ltr">\(i\)</span>, אז <span class="math" dir="ltr">\(\sum M_i \Delta x_i \ge \sum \varepsilon \Delta x_i = \varepsilon \sum \Delta x_i = \varepsilon (b-a)\)</span>, וזו סתירה. לכן, בהכרח יש לפחות קטע אחד <span class="math" dir="ltr">\(\Delta x_i\)</span> בחלוקה <span class="math" dir="ltr">\(T\)</span> שעבורו <span class="math" dir="ltr">\(M_i < \varepsilon\)</span>. כלומר, <span class="math" dir="ltr">\(\sup_{x \in \Delta x_i} f(x) < \varepsilon\)</span>, ובפרט <span class="math" dir="ltr">\(f(x) < \varepsilon\)</span> לכל <span class="math" dir="ltr">\(x \in \Delta x_i\)</span>. נוכל גם לדרוש שרוחב הקטע יהיה קטן כרצוננו ע"י בחירת חלוקה <span class="math" dir="ltr">\(T\)</span> עם <span class="math" dir="ltr">\(\lambda(T)\)</span> קטן מספיק.)</li>
                 </ul>
                 <p>כעת נמצא סדרת קטעים מכונסים וסדרת אפסילונים שיובילו לסתירה.</p>
                 <p>לפי (ב) עם <span class="math" dir="ltr">\(\varepsilon=1\)</span>, יש קטע <span class="math" dir="ltr">\([\alpha_1, \beta_1] \subseteq [a,b]\)</span> כך ש-<span class="math" dir="ltr">\(\beta_1 - \alpha_1 < 1\)</span> ולכל <span class="math" dir="ltr">\(x \in [\alpha_1, \beta_1]\)</span> מתקיים <span class="math" dir="ltr">\(f(x) \le 1\)</span>.</p>
                 <p>לפי (ב) על הקטע <span class="math" dir="ltr">\([\alpha_1, \beta_1]\)</span> (שגם בו האינטגרל 0, לפי (א)) עם <span class="math" dir="ltr">\(\varepsilon=1/2\)</span>, יש תת-קטע <span class="math" dir="ltr">\([\alpha_2, \beta_2] \subseteq [\alpha_1, \beta_1]\)</span> כך ש-<span class="math" dir="ltr">\(\beta_2 - \alpha_2 < 1/2\)</span> ולכל <span class="math" dir="ltr">\(x \in [\alpha_2, \beta_2]\)</span> מתקיים <span class="math" dir="ltr">\(f(x) \le 1/2\)</span>.</p>
                 <p>נמשיך כך וניצור סדרה אינסופית של קטעים סגורים המכילים זה את זה:</p>
                 <div class="formula-block"><div class="math" dir="ltr">$$ [a,b] \supseteq [\alpha_1, \beta_1] \supseteq [\alpha_2, \beta_2] \supseteq \dots \supseteq [\alpha_k, \beta_k] \supseteq \dots $$</div></div>
                 <p>כך ש-<span class="math" dir="ltr">\(\beta_k - \alpha_k < 1/k\)</span> ולכל <span class="math" dir="ltr">\(x \in [\alpha_k, \beta_k]\)</span> מתקיים <span class="math" dir="ltr">\((\star) \quad f(x) \le 1/k\)</span>.</p>
                  <p>לפי למת קנטור לקטעים סגורים, מכיוון שאורך הקטעים שואף ל-0 (<span class="math" dir="ltr">\(\beta_k - \alpha_k \to 0\)</span>), קיימת נקודה יחידה <span class="math" dir="ltr">\(x_0\)</span> המשותפת לכל הקטעים: <span class="math" dir="ltr">\(x_0 \in \bigcap_{k=1}^\infty [\alpha_k, \beta_k]\)</span>.</p>
                  <p>מכיוון ש-<span class="math" dir="ltr">\(x_0 \in [\alpha_k, \beta_k]\)</span> לכל <span class="math" dir="ltr">\(k\)</span>, לפי <span class="math" dir="ltr">\((\star)\)</span> מתקיים <span class="math" dir="ltr">\(f(x_0) \le 1/k\)</span> לכל <span class="math" dir="ltr">\(k \ge 1\)</span>. כאשר <span class="math" dir="ltr">\(k \to \infty\)</span>, נקבל <span class="math" dir="ltr">\(f(x_0) \le 0\)</span>.</p>
                  <p>וזו סתירה לנתון ש-<span class="math" dir="ltr">\(f(x) > 0\)</span> לכל <span class="math" dir="ltr">\(x \in [a,b]\)</span>.</p>
                  <p>לכן ההנחה בשלילה שגויה, ובהכרח <span class="math" dir="ltr">\(\int_a^b f(x) dx > 0\)</span>. מש"ל.</p>
                <p><strong>משפט (גרסה חזקה יותר עבור פונקציה רציפה):</strong> תהי <span class="math" dir="ltr">\(f(x)\)</span> רציפה ב-<span class="math" dir="ltr">\([a,b]\)</span>, <span class="math" dir="ltr">\(f(x) \ge 0\)</span> ב-<span class="math" dir="ltr">\([a,b]\)</span> אך <span class="math" dir="ltr">\(f \not\equiv 0\)</span> (כלומר, <span class="math" dir="ltr">\(f\)</span> אינה זהותית פונקצית האפס), אז <span class="math" dir="ltr">\(\int_a^b f(x) dx > 0\)</span>.</p>
                 <p><strong>הוכחה:</strong> מכיוון ש-<span class="math" dir="ltr">\(f \not\equiv 0\)</span> ו-<span class="math" dir="ltr">\(f \ge 0\)</span>, קיימת נקודה <span class="math" dir="ltr">\(x_0 \in [a,b]\)</span> כך ש-<span class="math" dir="ltr">\(f(x_0) = L > 0\)</span>.
                 מרציפות <span class="math" dir="ltr">\(f\)</span> ב-<span class="math" dir="ltr">\(x_0\)</span>, עבור <span class="math" dir="ltr">\(\varepsilon = L/2 > 0\)</span>, קיים <span class="math" dir="ltr">\(\delta > 0\)</span> כך שאם <span class="math" dir="ltr">\(|x-x_0| < \delta\)</span> (ו-<span class="math" dir="ltr">\(x \in [a,b]\)</span>), אז <span class="math" dir="ltr">\(|f(x) - f(x_0)| < L/2\)</span>.
                 זה גורר <span class="math" dir="ltr">\(f(x) > f(x_0) - L/2 = L - L/2 = L/2\)</span>.
                 כלומר, קיים קטע <span class="math" dir="ltr">\([\alpha, \beta] \subseteq [a,b]\)</span> המכיל את <span class="math" dir="ltr">\(x_0\)</span> (למשל, <span class="math" dir="ltr">\([\max(a, x_0-\delta/2), \min(b, x_0+\delta/2)]\)</span>) כך ש-<span class="math" dir="ltr">\(f(x) \ge L/2\)</span> לכל <span class="math" dir="ltr">\(x \in [\alpha, \beta]\)</span>, ואורך הקטע <span class="math" dir="ltr">\(\beta - \alpha > 0\)</span>.
                  ואז, לפי מונוטוניות האינטגרל (סעיף 10):
                 </p>
                  <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b f(x) dx = \int_a^\alpha f(x) dx + \int_\alpha^\beta f(x) dx + \int_\beta^b f(x) dx $$</div></div>
                  מכיוון ש-<span class="math" dir="ltr">\(f \ge 0\)</span>, האינטגרלים הראשון והשלישי אי-שליליים. לכן:
                 <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b f(x) dx \ge \int_\alpha^\beta f(x) dx $$</div></div>
                 בקטע <span class="math" dir="ltr">\([\alpha, \beta]\)</span> מתקיים <span class="math" dir="ltr">\(f(x) \ge L/2\)</span>, לכן שוב ממונוטוניות:
                 <div class="formula-block"><div class="math" dir="ltr">$$ \int_\alpha^\beta f(x) dx \ge \int_\alpha^\beta \frac{L}{2} dx = \frac{L}{2} (\beta - \alpha) $$</div></div>
                 מכיוון ש-<span class="math" dir="ltr">\(L > 0\)</span> ו-<span class="math" dir="ltr">\(\beta - \alpha > 0\)</span>, נקבל <span class="math" dir="ltr">\(\frac{L}{2}(\beta - \alpha) > 0\)</span>.
                  לכן <span class="math" dir="ltr">\(\int_a^b f(x) dx > 0\)</span>. מש"ל.
            </section>

             <section id="prop-triangle">
                <h3>12. אי-שוויון המשולש לאינטגרלים</h3>
                <p>אם <span class="math" dir="ltr">\(f\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([a,b]\)</span>, אז גם <span class="math" dir="ltr">\(|f|\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([a,b]\)</span> ו-</p>
                 <div class="formula-block"><div class="math" dir="ltr">$$ (\star) \quad \left| \int_a^b f(x) dx \right| \le \int_a^b |f(x)| dx $$</div></div>
                 <p>(זה בעצם אי שוויון המשולש עבור אינטגרלים).</p>
                  <p><strong>הוכחה:</strong></p>
                  <p><strong>אינטגרביליות של <span class="math" dir="ltr">\(|f|\)</span>:</strong>
                  <span class="math" dir="ltr">\(f\)</span> אינטגרבילית ולכן חסומה. אם <span class="math" dir="ltr">\(|f(x)| \le M\)</span>, אז גם <span class="math" dir="ltr">\(| |f(x)| | \le M\)</span>, כלומר <span class="math" dir="ltr">\(|f|\)</span> חסומה.
                  כעת, נשתמש באי-שוויון המשולש ההפוך למספרים: <span class="math" dir="ltr">\(||a| - |b|| \le |a-b|\)</span>. לכן לכל <span class="math" dir="ltr">\(x, z \in [a,b]\)</span>:
                  </p>
                  <div class="formula-block"><div class="math" dir="ltr">$$ ||f(x)| - |f(z)|| \le |f(x) - f(z)| $$</div></div>
                  <p>מכאן נובע שלכל קטע <span class="math" dir="ltr">\(I \subseteq [a,b]\)</span>, התנודה של <span class="math" dir="ltr">\(|f|\)</span> ב-<span class="math" dir="ltr">\(I\)</span> קטנה או שווה לתנודה של <span class="math" dir="ltr">\(f\)</span> ב-<span class="math" dir="ltr">\(I\)</span>:</p>
                  <div class="formula-block"><div class="math" dir="ltr">$$ \omega_I(|f|) \le \omega_I(f) $$</div></div>
                  <p>לכן, לכל חלוקה <span class="math" dir="ltr">\(T\)</span>:</p>
                   <div class="formula-block"><div class="math" dir="ltr">$$ 0 \le S_T(|f|) - s_T(|f|) = \sum \omega_{\Delta x_i}(|f|) \Delta x_i \le \sum \omega_{\Delta x_i}(f) \Delta x_i = S_T(f) - s_T(f) $$</div></div>
                  <p>כאשר <span class="math" dir="ltr">\(\lambda(T) \to 0\)</span>, <span class="math" dir="ltr">\(S_T(f) - s_T(f) \to 0\)</span> (כי <span class="math" dir="ltr">\(f\)</span> אינטגרבילית). לפי משפט הסנדוויץ', גם <span class="math" dir="ltr">\(S_T(|f|) - s_T(|f|) \to 0\)</span>. מכיוון ש-<span class="math" dir="ltr">\(|f|\)</span> חסומה, היא אינטגרבילית לפי קריטריון רימן.</p>
                   <p><strong>הוכחת האי-שוויון <span class="math" dir="ltr">\((\star)\)</span>:</strong>
                   ידוע שלכל <span class="math" dir="ltr">\(x\)</span> מתקיים <span class="math" dir="ltr">\(-|f(x)| \le f(x) \le |f(x)|\)</span>.
                   מכיוון ש-<span class="math" dir="ltr">\(f\)</span> ו-<span class="math" dir="ltr">\(|f|\)</span> אינטגרביליות, ניתן להפעיל אינטגרל על האי-שוויון ולקבל (לפי מונוטוניות, סעיף 10):
                   </p>
                   <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b (-|f(x)|) dx \le \int_a^b f(x) dx \le \int_a^b |f(x)| dx $$</div></div>
                    <div class="formula-block"><div class="math" dir="ltr">$$ - \int_a^b |f(x)| dx \le \int_a^b f(x) dx \le \int_a^b |f(x)| dx $$</div></div>
                   <p>וזה בדיוק אומר ש:</p>
                   <div class="formula-block"><div class="math" dir="ltr">$$ \left| \int_a^b f(x) dx \right| \le \int_a^b |f(x)| dx $$</div></div>
                   <p>מש"ל.</p>
                   <p><strong>דרך הוכחה נוספת לאי-שוויון <span class="math" dir="ltr">\((\star)\)</span>:</strong>
                   לפי אי שוויון המשולש למספרים, לכל סכום רימן <span class="math" dir="ltr">\(\sigma(f, T, \{\zeta_i\}) = \sum f(\zeta_i) \Delta x_i\)</span> מתקיים:
                   </p>
                   <div class="formula-block"><div class="math" dir="ltr">$$ \left| \sum_{i=1}^k f(\zeta_i) \Delta x_i \right| \le \sum_{i=1}^k |f(\zeta_i) \Delta x_i| = \sum_{i=1}^k |f(\zeta_i)| \Delta x_i $$</div></div>
                    <p>אגף ימין הוא סכום רימן של <span class="math" dir="ltr">\(|f|\)</span> עבור אותה חלוקה ואותן נקודות. כשנשאיף <span class="math" dir="ltr">\(\lambda(T) \to 0\)</span>, אגף שמאל ישאף ל-<span class="math" dir="ltr">\(|\int_a^b f(x) dx|\)</span> ואגף ימין ישאף ל-<span class="math" dir="ltr">\(\int_a^b |f(x)| dx\)</span>. מכיוון שהאי-שוויון נשמר בגבול, נקבל את <span class="math" dir="ltr">\((\star)\)</span>. מש"ל.</p>

                 <div class="example">
                     <h4>דוגמה לכך שההיפך אינו נכון</h4>
                     <p>הכיוון ההפוך אינו נכון: ייתכן ש-<span class="math" dir="ltr">\(|f|\)</span> אינטגרבילית אך <span class="math" dir="ltr">\(f\)</span> לא.</p>
                     <p>ניקח את פונקציית דיריכלה מוזזת:</p>
                      <div class="formula-block"><div class="math" dir="ltr">$$ D(x) = \begin{cases} 1 & x \in \mathbb{Q} \\ -1 & x \notin \mathbb{Q} \end{cases} $$</div></div>
                     <p>בקטע <span class="math" dir="ltr">\([0,1]\)</span>, <span class="math" dir="ltr">\(D(x)\)</span> אינה אינטגרבילית (לפי משפט לבג, קבוצת אי הרציפות היא <span class="math" dir="ltr">\([0,1]\)</span> שאינה בעלת מידה 0; או לפי סכומי רימן, הסכום העליון תמיד 1 והתחתון תמיד -1).</p>
                      <p>אך <span class="math" dir="ltr">\(|D(x)| \equiv 1\)</span> לכל <span class="math" dir="ltr">\(x\)</span>. זו פונקציה קבועה ולכן אינטגרבילית, ו-<span class="math" dir="ltr">\(\int_0^1 |D(x)| dx = \int_0^1 1 dx = 1\)</span>.</p>
                 </div>
             </section>

             <section id="ivt-integrals">
                 <h2>13. משפט ערך הביניים לאינטגרלים</h2>
                 <p>יש את משפט ערך הביניים לפונקציות רציפות, לפונקציות גזירות (משפט לגראנז'), ומסתבר שיש גם לאינטגרלים מסוימים.</p>
                 <div class="definition">
                     <h4>משפט ערך הביניים המוכלל לאינטגרלים</h4>
                     <p>תהי <span class="math" dir="ltr">\(f(x)\)</span> רציפה ב-<span class="math" dir="ltr">\([a,b]\)</span>, ו-<span class="math" dir="ltr">\(g(x)\)</span> אינטגרבילית ב-<span class="math" dir="ltr">\([a,b]\)</span> עם סימן קבוע (כלומר, <span class="math" dir="ltr">\(\forall x: g(x) \ge 0\)</span> או <span class="math" dir="ltr">\(\forall x: g(x) \le 0\)</span>).
                     אז קיימת נקודה <span class="math" dir="ltr">\(c \in [a,b]\)</span> כך ש-</p>
                     <div class="formula-block"><div class="math" dir="ltr">$$ (\star) \quad \int_a^b f(x) g(x) dx = f(c) \int_a^b g(x) dx $$</div></div>
                 </div>
                 <p><strong>הוכחה:</strong>
                 ראשית, הפונקציה <span class="math" dir="ltr">\(f \cdot g\)</span> אינטגרבילית (כי <span class="math" dir="ltr">\(f\)</span> רציפה ולכן אינטגרבילית, <span class="math" dir="ltr">\(g\)</span> אינטגרבילית, ומכפלת אינטגרביליות היא אינטגרבילית - סעיף 3).
                 נניח בהגבלת הכלליות כי <span class="math" dir="ltr">\(g(x) \ge 0\)</span> לכל <span class="math" dir="ltr">\(x \in [a,b]\)</span> (אם <span class="math" dir="ltr">\(g \le 0\)</span>, נפעיל את המשפט על <span class="math" dir="ltr">\(-g\)</span> ו-<span class="math" dir="ltr">\(f\)</span>).
                 </p>
                  <p><span class="math" dir="ltr">\(f\)</span> רציפה בקטע סגור <span class="math" dir="ltr">\([a,b]\)</span>, לכן היא חסומה ואף מקבלת מקסימום <span class="math" dir="ltr">\(M\)</span> ומינימום <span class="math" dir="ltr">\(m\)</span> בקטע (ממשפט ויירשטראס). כלומר, קיימים <span class="math" dir="ltr">\(x_m, x_M \in [a,b]\)</span> כך ש-<span class="math" dir="ltr">\(f(x_m)=m\)</span>, <span class="math" dir="ltr">\(f(x_M)=M\)</span>, ולכל <span class="math" dir="ltr">\(x \in [a,b]\)</span> מתקיים <span class="math" dir="ltr">\(m \le f(x) \le M\)</span>.</p>
                  <p>מכיוון ש-<span class="math" dir="ltr">\(g(x) \ge 0\)</span>, נכפיל את האי-שוויון ב-<span class="math" dir="ltr">\(g(x)\)</span>:</p>
                  <div class="formula-block"><div class="math" dir="ltr">$$ m g(x) \le f(x) g(x) \le M g(x) $$</div></div>
                  <p>נפעיל אינטגרל על האי-שוויון (לפי מונוטוניות, סעיף 10):</p>
                   <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b m g(x) dx \le \int_a^b f(x) g(x) dx \le \int_a^b M g(x) dx $$</div></div>
                   <div class="formula-block"><div class="math" dir="ltr">$$ (\divideontimes) \quad m \int_a^b g(x) dx \le \int_a^b f(x) g(x) dx \le M \int_a^b g(x) dx $$</div></div>
                   <p>כעת, יש שני מקרים:</p>
                   <p><strong>מקרה 1:</strong> <span class="math" dir="ltr">\(\int_a^b g(x) dx = 0\)</span>.
                   מכיוון ש-<span class="math" dir="ltr">\(g(x) \ge 0\)</span>, זה קורה אם ורק אם <span class="math" dir="ltr">\(g(x) = 0\)</span> כמעט בכל מקום (במקרה ש-<span class="math" dir="ltr">\(g\)</span> רציפה, זה קורה רק אם <span class="math" dir="ltr">\(g \equiv 0\)</span>).
                    מהאי-שוויון <span class="math" dir="ltr">\((\divideontimes)\)</span> נקבל:
                   </p>
                   <div class="formula-block"><div class="math" dir="ltr">$$ m \cdot 0 \le \int_a^b f(x) g(x) dx \le M \cdot 0 $$</div></div>
                    <p>כלומר, <span class="math" dir="ltr">\(\int_a^b f(x) g(x) dx = 0\)</span>.
                   במקרה זה, הנוסחה <span class="math" dir="ltr">\((\star)\)</span> הופכת ל-<span class="math" dir="ltr">\(0 = f(c) \cdot 0\)</span>, שמתקיימת לכל <span class="math" dir="ltr">\(c \in [a,b]\)</span>.</p>
                   <p><strong>מקרה 2:</strong> <span class="math" dir="ltr">\(\int_a^b g(x) dx > 0\)</span>.
                   (זה קורה אם <span class="math" dir="ltr">\(g \ge 0\)</span> אינטגרבילית ולא שווה זהותית ל-0 כמעט בכל מקום).
                   במקרה זה, ניתן לחלק את האי-שוויון <span class="math" dir="ltr">\((\divideontimes)\)</span> ב-<span class="math" dir="ltr">\(\int_a^b g(x) dx\)</span> (שהוא מספר חיובי) ולקבל:
                   </p>
                    <div class="formula-block"><div class="math" dir="ltr">$$ m \le \frac{\int_a^b f(x) g(x) dx}{\int_a^b g(x) dx} \le M $$</div></div>
                    <p>נסמן <span class="math" dir="ltr">\(Y = \frac{\int_a^b f(x) g(x) dx}{\int_a^b g(x) dx}\)</span>. קיבלנו <span class="math" dir="ltr">\(m \le Y \le M\)</span>.
                    מכיוון ש-<span class="math" dir="ltr">\(f\)</span> רציפה ב-<span class="math" dir="ltr">\([a,b]\)</span>, והיא מקבלת את הערכים <span class="math" dir="ltr">\(m\)</span> ו-<span class="math" dir="ltr">\(M\)</span> בקטע, אז לפי משפט ערך הביניים הרגיל לפונקציות רציפות, <span class="math" dir="ltr">\(f\)</span> מקבלת כל ערך בין <span class="math" dir="ltr">\(m\)</span> ל-<span class="math" dir="ltr">\(M\)</span>. בפרט, קיים <span class="math" dir="ltr">\(c \in [a,b]\)</span> כך ש-<span class="math" dir="ltr">\(f(c) = Y\)</span>.</p>
                   <div class="formula-block"><div class="math" dir="ltr">$$ f(c) = \frac{\int_a^b f(x) g(x) dx}{\int_a^b g(x) dx} $$</div></div>
                    <p>ומכאן נובעת הנוסחה <span class="math" dir="ltr">\((\star)\)</span>.</p>
                 <p><strong>תרגיל:</strong> הראה/י שניתן בכל מקרה להבטיח אי שוויונים חדים/חזקים, כלומר <span class="math" dir="ltr">\(a<c<b\)</span> (אלא אם <span class="math" dir="ltr">\(f\)</span> קבועה או <span class="math" dir="ltr">\(g \equiv 0\)</span>). סוף.</p>
                 <div class="definition">
                     <h4>משפט ערך הביניים הראשון לאינטגרלים (מקרה פרטי)</h4>
                     <p>אם <span class="math" dir="ltr">\(f\)</span> רציפה ב-<span class="math" dir="ltr">\([a,b]\)</span>, אז קיימת נקודה <span class="math" dir="ltr">\(c \in [a,b]\)</span> כך ש-</p>
                      <div class="formula-block"><div class="math" dir="ltr">$$ \int_a^b f(x) dx = f(c) (b-a) $$</div></div>
                     <p><strong>הוכחה:</strong> זהו מקרה פרטי של המשפט המוכלל עם <span class="math" dir="ltr">\(g(x) \equiv 1\)</span>. הפונקציה <span class="math" dir="ltr">\(g(x)=1\)</span> היא אינטגרבילית ואי-שלילית. האינטגרל שלה הוא <span class="math" dir="ltr">\(\int_a^b 1 dx = b-a\)</span>. הצבה בנוסחה <span class="math" dir="ltr">\((\star)\)</span> נותנת את התוצאה.</p>
                 </div>
             </section>
        </main>
    </div>

    <!-- KaTeX JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- Shared Dark Mode JavaScript -->
    <script src="../scripts/dark-mode.js"></script>

    <!-- Custom Script for Rendering, Enhancements, Dark Mode, and Charts -->
    <script>
        // --- Global Chart References ---
        let stepFunctionChart = null;

       // --- Function to get current theme colors from CSS Variables ---
       function getChartColors() {
           const style = getComputedStyle(document.documentElement);
           const getColor = (varName, fallback) => style.getPropertyValue(varName).trim() || fallback;

           return {
               axisColor: getColor('--chart-axis-color', '#333333'),
               gridColor: getColor('--chart-grid-color', 'rgba(128, 128, 128, 0.2)'),
               textColor: getColor('--text-color', '#343a40'),
               primaryColor: getColor('--primary-color', '#0a5a8d'),
               accentColor: getColor('--accent-color', '#f0ad4e'),
               fillColor1: 'rgba(10, 90, 141, 0.3)', // Fill for first step
               fillColor2: 'rgba(240, 173, 78, 0.3)', // Fill for second step (using accent variation)
               bgColor: getColor('--card-bg', '#ffffff')
           };
       }

       // --- Function to render Step Function Chart ---
       function renderStepFunctionChart() {
           const ctx = document.getElementById('stepFunctionChart')?.getContext('2d');
           if (!ctx) return;

           const colors = getChartColors();

           // Data points representing the steps
           const dataPoints = [
               { x: 0, y: 1 },
               { x: 1, y: 1 }, // End of first step
               { x: 1, y: 2 }, // Start of second step (use NaN or separate dataset for discontinuity)
               { x: 2, y: 2 }  // End of second step
           ];
            // Create data for Chart.js. Use 'stepped: true' or manage segments carefully.
            // Using segments for better control over discontinuity:
            const dataset1 = [ {x: 0, y: 1}, {x: 1, y: 1} ];
            const dataset2 = [ {x: 1, y: 2}, {x: 2, y: 2} ];


           const data = {
               datasets: [
                   {
                       label: 'f(x) = 1',
                       data: dataset1,
                       borderColor: colors.primaryColor,
                       backgroundColor: colors.fillColor1,
                       borderWidth: 2.5,
                       pointRadius: [4, 0], // Solid start, open end conceptually (though visually hard)
                       pointBorderColor: colors.primaryColor,
                       pointBackgroundColor: colors.bgColor, // For open circle look
                       stepped: 'before', // Or handle manually
                       fill: { // Fill under the step
                           target: 'origin', // Fill down to y=0
                           above: colors.fillColor1,
                        }
                   },
                   {
                       label: 'f(x) = 2',
                       data: dataset2,
                       borderColor: colors.accentColor,
                       backgroundColor: colors.fillColor2,
                       borderWidth: 2.5,
                       pointRadius: [4, 4], // Open start, solid end conceptually
                       pointBorderColor: colors.accentColor,
                       pointBackgroundColor: [colors.bgColor, colors.accentColor], // Open/Solid
                       stepped: 'before', // Or handle manually
                       fill: {
                           target: 'origin',
                           above: colors.fillColor2,
                       }
                   }
               ]
           };


           const options = {
               responsive: true,
               maintainAspectRatio: true,
               aspectRatio: 1.8, // Adjust aspect ratio
               plugins: {
                   tooltip: {
                       enabled: true,
                       mode: 'index',
                       intersect: false,
                       callbacks: {
                            label: function(context) {
                               let label = context.dataset.label || '';
                               if (label) { label += ': '; }
                               label += `(${context.parsed.x.toFixed(2)}, ${context.parsed.y.toFixed(2)})`;
                               return label;
                           },
                            title: () => null // No title needed for single points
                       }
                   },
                   legend: {
                       display: false // Can hide legend if steps are clear
                   }
               },
               scales: {
                   x: {
                       type: 'linear',
                       min: -0.1, max: 2.1,
                       title: { display: true, text: 'x', color: colors.textColor },
                       grid: { color: context => context.tick.value === 0 ? colors.axisColor : colors.gridColor, lineWidth: context => context.tick.value === 0 ? 1.5 : 1 },
                       ticks: { color: colors.textColor, stepSize: 0.5 }
                   },
                   y: {
                       min: 0, max: 2.5,
                       title: { display: true, text: 'f(x)', color: colors.textColor },
                       grid: { color: context => context.tick.value === 0 ? colors.axisColor : colors.gridColor, lineWidth: context => context.tick.value === 0 ? 1.5 : 1 },
                       ticks: { color: colors.textColor, stepSize: 0.5 }
                   }
               },
               elements: {
                    line: {
                        tension: 0 // Straight lines for steps
                    }
                },
                // Custom drawing for open/closed circles at discontinuity? (Requires plugin or more complex setup)
           };

           if (stepFunctionChart) stepFunctionChart.destroy(); // Destroy previous instance
           stepFunctionChart = new Chart(ctx, { type: 'line', data: data, options: options });
       }

       // --- Function to render all charts ---
        function renderAllCharts() {
            renderStepFunctionChart();
        }

       // --- Scroll nav to show active link ---
       function scrollToActiveLink() {
           const navList = document.querySelector('#main-nav ul');
           const activeLink = navList?.querySelector('a.active');
           if (!activeLink || !navList) return;

           const navListRect = navList.getBoundingClientRect();
           const activeLinkRect = activeLink.getBoundingClientRect();

            // Check if active link is outside the visible area of the navList
            const isVisible =
               activeLinkRect.left >= navListRect.left &&
               activeLinkRect.right <= navListRect.right;

           if (!isVisible) {
                // Calculate scroll position to center the link
                const scrollLeftTarget = navList.scrollLeft + activeLinkRect.left - navListRect.left - (navListRect.width / 2) + (activeLinkRect.width / 2);

                navList.scrollTo({
                   left: scrollLeftTarget,
                   behavior: 'smooth'
               });
            }
       }

       // --- General Setup on DOMContentLoaded ---
        document.addEventListener('DOMContentLoaded', function() {
            // --- 1. KaTeX Rendering ---
             try {
                  renderMathInElement(document.body, {
                     delimiters: [
                         {left: '$$', right: '$$', display: true, preProcess: (math) => math.replace(/\\\\/g, '\\')},
                         {left: '\\[', right: '\\]', display: true, preProcess: (math) => math.replace(/\\\\/g, '\\')},
                         {left: '\\(', right: '\\)', display: false, preProcess: (math) => math.replace(/\\\\/g, '\\')},
                         {left: '$', right: '$', display: false, preProcess: (math) => math.replace(/\\\\/g, '\\')} // Allow single $
                     ],
                     // Custom wrapper logic using div.math / span.math for block/inline
                     trust: true, // Allows rendering potentially complex html generated by katex
                     strict: (errorCode) => (errorCode === 'unicodeTextInMathMode' ? 'ignore' : 'warn'), // Less strict error handling, ignore unicode in math
                     output: 'htmlAndMathml', // Better accessibility
                     ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'canvas'],
                     ignoredClasses: ['no-math'],
                     throwOnError: false,
                      preProcess: (math) => {
                           // Remove specific problematic characters if needed before rendering
                          // Example: math = math.replace(/[\u202A-\u202E]/g, ''); // Remove embedding controls if they cause issues
                          return math.replace(/\\\\/g, '\\'); // Fix double backslashes common from copy-paste
                      }
                  });
                 // Ensure display math is correctly wrapped
                 document.querySelectorAll('.katex-display').forEach(displayMath => {
                     const parent = displayMath.parentElement;
                     // If parent is not div.math, wrap it
                     if (!parent || parent.tagName !== 'DIV' || !parent.classList.contains('math')) {
                         const divMath = document.createElement('div');
                         divMath.className = 'math';
                         divMath.setAttribute('dir', 'ltr');
                          // Insert the wrapper before the original display math element
                          displayMath.parentNode.insertBefore(divMath, displayMath);
                          // Move the display math element inside the wrapper
                          divMath.appendChild(displayMath);
                      }
                      // Ensure the div.math parent is inside a formula-block
                      const mathParent = displayMath.closest('div.math');
                      if (mathParent && (!mathParent.parentElement || !mathParent.parentElement.classList.contains('formula-block'))) {
                           const formulaBlock = document.createElement('div');
                           formulaBlock.className = 'formula-block';
                           mathParent.parentNode.insertBefore(formulaBlock, mathParent);
                           formulaBlock.appendChild(mathParent);
                       }
                  });
                  // Ensure inline math has the right class and dir
                  document.querySelectorAll('.katex').forEach(inlineMath => {
                      // Only target inline math (which is typically wrapped in a span by KaTeX)
                      if (inlineMath.tagName === 'SPAN' && !inlineMath.classList.contains('katex-display')) {
                          // Add .math class if missing
                          if (!inlineMath.classList.contains('math')) {
                              inlineMath.classList.add('math');
                           }
                           // Ensure dir="ltr"
                          inlineMath.setAttribute('dir', 'ltr');
                       }
                  });

             } catch (error) {
                 console.error("KaTeX auto-rendering failed:", error);
             }

             // --- 2. Active Navigation Link Highlighting ---
             const navLinks = document.querySelectorAll('#main-nav a.nav-link');
             const sections = document.querySelectorAll('main section');
             const navElement = document.querySelector('nav');
             const navHeight = navElement ? navElement.offsetHeight : 60;

            function changeActiveLink() {
                let currentSectionId = '';
                const scrollPosition = window.scrollY;

                // Find the section currently in view or the last one passed
                for (let i = sections.length - 1; i >= 0; i--) {
                    const section = sections[i];
                    // Adjust offset slightly more to trigger link activation a bit earlier when scrolling down
                    const sectionTop = section.offsetTop - navHeight - 70;

                    if (scrollPosition >= sectionTop) {
                        currentSectionId = section.getAttribute('id');
                        break; // Found the current or last passed section
                    }
                }

               // If scrolled near the top, activate the first link
               if (currentSectionId === '' && sections.length > 0 && scrollPosition < sections[0].offsetTop - navHeight - 70) {
                    currentSectionId = sections[0].getAttribute('id');
                }

               // Activate the correct link
                let activeLinkFound = false;
                navLinks.forEach(link => {
                     link.classList.remove('active');
                     const linkHrefId = link.getAttribute('href')?.substring(1); // Safe navigation with optional chaining
                     if (linkHrefId && linkHrefId === currentSectionId) {
                          link.classList.add('active');
                          activeLinkFound = true;
                      }
                  });

                // Fallback if no exact match and scrolled down, activate the first
                if (!activeLinkFound && navLinks.length > 0) {
                    navLinks[0].classList.add('active');
                }


               // Scroll the nav bar to show the active link
                scrollToActiveLink();

            }
            // Debounce or Throttle the scroll event listener for performance
            let scrollTimeout;
            window.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(changeActiveLink, 50); // Adjust delay as needed
            }, { passive: true });
            changeActiveLink(); // Initial check


            // --- 3. Section Fade-in Animation on Scroll ---
              const observerOptions = {
                  root: null,
                  rootMargin: '0px 0px -10% 0px', // Trigger when 10% from bottom enters view
                  threshold: 0.1 // At least 10% visible
             };

              const observerCallback = (entries, observer) => {
                 entries.forEach(entry => {
                     if (entry.isIntersecting) {
                         entry.target.classList.add('visible');
                         observer.unobserve(entry.target); // Stop observing once visible
                     }
                 });
             };

             const scrollObserver = new IntersectionObserver(observerCallback, observerOptions);
             sections.forEach(section => {
                 scrollObserver.observe(section);
              });


            // --- 4. Dark Mode ---
            const darkModeToggle = document.getElementById('darkModeToggle');
            const htmlElement = document.documentElement;

            const applyTheme = (theme) => {
                htmlElement.setAttribute('data-theme', theme);
                darkModeToggle.setAttribute('aria-pressed', theme === 'dark');
                localStorage.setItem('globalTheme', theme);
                 // Re-render charts with new colors
                 // Add a slight delay to allow CSS transitions to start
                 setTimeout(renderAllCharts, 50); // Ensure this calls the chart rendering function
            };

            // Determine initial theme: 1. Local storage, 2. System preference, 3. Default to light
            const savedTheme = localStorage.getItem('globalTheme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            let initialTheme = 'light'; // Default
            if (savedTheme) {
                initialTheme = savedTheme;
            } else if (prefersDark) {
               initialTheme = 'dark';
            }

            applyTheme(initialTheme); // Apply initial theme *before* rendering charts

            darkModeToggle.addEventListener('click', () => {
                const currentTheme = htmlElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                applyTheme(newTheme);
            });

            // Listen for system theme changes ONLY if the user hasn't manually set a theme
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (!localStorage.getItem('globalTheme')) { // Only respect system preference if no manual choice
                    const newTheme = e.matches ? 'dark' : 'light';
                    applyTheme(newTheme);
                }
            });

           // --- 5. Initial Chart Rendering ---
           // Render only after DOM is ready and initial theme is set
           renderAllCharts(); // Ensure this calls the chart rendering function

         });
     </script>

<!-- כפתור חזרה לדף הראשי -->
<a href="../index.html" style="
  position: fixed;
  top: 20px;
  right: 20px;
  background-color: #0a5a8d;
  color: white;
  padding: 10px 16px;
  border-radius: 30px;
  text-decoration: none;
  font-size: 14px;
  z-index: 999;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
">
  🏠 חזרה למסך הראשי
</a>

</body>
</html>